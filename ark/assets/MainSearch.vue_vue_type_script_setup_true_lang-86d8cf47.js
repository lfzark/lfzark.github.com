import{dG as q,dH as V,dI as A,dJ as B,h as x,A as D,dK as pe,dL as E,dM as ne,dN as he,C as me,dO as ge,d as we,u as ye,co as ke,Q as _e,bo as be,c as b,c9 as O,c2 as G,f as p,b as h,$ as Q,bw as Y,bd as J,c1 as $e,b5 as xe,a8 as C,ab as R,g as X,a9 as Se,dP as Ce,o as $,n as Ie,t as N,cw as Ee}from"./index-3d7fbf2c.js";import{u as qe}from"./icon_style-1e29394a.js";function L(t){return Object.keys(t).map(n=>`${encodeURIComponent(n)}=${encodeURIComponent(t[n])}`).join("&")}function Le(t){return`https://www.baidu.com/s?wd=${encodeURIComponent(t)}`}function Oe(t,o){const n=L({prod:"wise",wd:t});q(`https://www.baidu.com/sugrec?${n}`).then(e=>e.json()).then(e=>{o({eng:"baidu",wd:e.q,list:e.g?e.g.map(r=>r.q):[]})}).catch(e=>console.error(e))}const Re={target:Le,complete:Oe};function Ae(t){return`https://www.google.com/search?q=${encodeURIComponent(t)}`}function je(t,o){const n=L({client:"psy-ab",hl:"zh-CN",q:t});q(`https://suggestqueries.google.com/complete/search?${n}`).then(e=>e.json()).then(e=>{o({eng:"google",wd:e[0],list:e[1].map(r=>r[0])})}).catch(e=>console.error(e))}const De={target:Ae,complete:je};function Me(t){return`https://www.bing.com/search?mkt=zh-cn&q=${encodeURIComponent(t)}`}function Ne(t,o){const n=L({type:"cb",q:t});q(`https://api.bing.com/qsonhs.aspx?${n}`,{jsonpCallback:"cb"}).then(e=>e.json()).then(e=>{const r=e.AS.Results;let a;r?a=r.map(f=>f.Suggests).reduce((f,c)=>f.concat(c),[]).sort((f,c)=>f.Sk>c.Sk?1:-1).map(f=>f.Txt):a=[],o({eng:"bing",wd:e.AS.Query,list:a})}).catch(e=>console.error(e))}const Ue={target:Me,complete:Ne};function ze(t){return`https://zh.wikipedia.org/w/index.php?search=${encodeURIComponent(t)}`}function Be(t,o){const n=L({action:"opensearch",format:"json",formatversion:2,limit:10,search:t});q(`https://zh.wikipedia.org/w/api.php?${n}`).then(e=>e.json()).then(e=>{o({eng:"wikipedia",wd:e[0],list:e[1]})}).catch(e=>console.error(e))}const Ke={target:ze,complete:Be};function Te(t){return`https://www.sogou.com/web?query=${encodeURIComponent(t)}`}function We(t,o){const n=`https://wap.sogou.com/web/sugg/${encodeURIComponent(t)}`,e=L({vr:1,s:1,source:"wapsearch",encrypt:0,cb:"sug"});window.sug=r=>{o({eng:"sogou",wd:r.q,list:r.s?r.s.map(a=>a.q):[]})},q(`${n}?${e}`,{jsonpCallback:"sug"}).catch(r=>r)}const Fe={target:Te,complete:We},oe={Baidu:Re,Google:De,Bing:Ue,Wikipedia:Ke,Sogou:Fe};function Pe(t,o){return oe[t].target(o)}function He(t,o,n){return oe[t].complete(o,n)}const Ve={target:Pe,complete:He};function I(t){var o;const n=E(t);return(o=n==null?void 0:n.$el)!=null?o:n}const se=ge?window:void 0;function j(...t){let o,n,e,r;if(typeof t[0]=="string"||Array.isArray(t[0])?([n,e,r]=t,o=se):[o,n,e,r]=t,!o)return A;Array.isArray(n)||(n=[n]),Array.isArray(e)||(e=[e]);const a=[],f=()=>{a.forEach(w=>w()),a.length=0},c=(w,k,l,i)=>(w.addEventListener(k,l,i),()=>w.removeEventListener(k,l,i)),g=D(()=>[I(o),E(r)],([w,k])=>{if(f(),!w)return;const l=pe(k)?{...k}:k;a.push(...n.flatMap(i=>e.map(u=>c(w,i,u,l))))},{immediate:!0,flush:"post"}),d=()=>{g(),f()};return ne(d),d}let Z=!1;function ee(t,o,n={}){const{window:e=se,ignore:r=[],capture:a=!0,detectIframe:f=!1}=n;if(!e)return A;B&&!Z&&(Z=!0,Array.from(e.document.body.children).forEach(l=>l.addEventListener("click",A)),e.document.documentElement.addEventListener("click",A));let c=!0;const g=l=>r.some(i=>{if(typeof i=="string")return Array.from(e.document.querySelectorAll(i)).some(u=>u===l.target||l.composedPath().includes(u));{const u=I(i);return u&&(l.target===u||l.composedPath().includes(u))}}),w=[j(e,"click",l=>{const i=I(t);if(!(!i||i===l.target||l.composedPath().includes(i))){if(l.detail===0&&(c=!g(l)),!c){c=!0;return}o(l)}},{passive:!0,capture:a}),j(e,"pointerdown",l=>{const i=I(t);c=!g(l)&&!!(i&&!l.composedPath().includes(i))},{passive:!0}),f&&j(e,"blur",l=>{setTimeout(()=>{var i;const u=I(t);((i=e.document.activeElement)==null?void 0:i.tagName)==="IFRAME"&&!(u!=null&&u.contains(e.document.activeElement))&&o(l)},0)})].filter(Boolean);return()=>w.forEach(l=>l())}const te={[V.mounted](t,o){const n=!o.modifiers.bubble;if(typeof o.value=="function")t.__onClickOutside_stop=ee(t,o.value,{capture:n});else{const[e,r]=o.value;t.__onClickOutside_stop=ee(t,e,Object.assign({capture:n},r))}},[V.unmounted](t){t.__onClickOutside_stop()}};function U(t){return typeof Window<"u"&&t instanceof Window?t.document.documentElement:typeof Document<"u"&&t instanceof Document?t.documentElement:t}function re(t){const o=window.getComputedStyle(t);if(o.overflowX==="scroll"||o.overflowY==="scroll"||o.overflowX==="auto"&&t.clientWidth<t.scrollWidth||o.overflowY==="auto"&&t.clientHeight<t.scrollHeight)return!0;{const n=t.parentNode;return!n||n.tagName==="BODY"?!1:re(n)}}function Ge(t){const o=t||window.event,n=o.target;return re(n)?!1:o.touches.length>1?!0:(o.preventDefault&&o.preventDefault(),!1)}const z=new WeakMap;function Qe(t,o=!1){const n=x(o);let e=null,r="";D(he(t),c=>{const g=U(E(c));if(g){const d=g;if(z.get(d)||z.set(d,d.style.overflow),d.style.overflow!=="hidden"&&(r=d.style.overflow),d.style.overflow==="hidden")return n.value=!0;if(n.value)return d.style.overflow="hidden"}},{immediate:!0});const a=()=>{const c=U(E(t));!c||n.value||(B&&(e=j(c,"touchmove",g=>{Ge(g)},{passive:!1})),c.style.overflow="hidden",n.value=!0)},f=()=>{const c=U(E(t));!c||!n.value||(B&&(e==null||e()),c.style.overflow=r,z.delete(c),n.value=!1)};return ne(f),me({get(){return n.value},set(c){c?a():f()}})}function Ye(){let t=!1;const o=x(!1);return(n,e)=>{if(o.value=e.value,t)return;t=!0;const r=Qe(n,e.value);D(o,a=>r.value=a)}}Ye();const Je={dark:"bg-$bg-c",w:"full sm:450!",bg:"gray-200",relative:"","mx-auto":"",flex:"","h-44":""},Xe={bg:"$main-bg-c",border:"2 t-0","z-9":"","py-6":"","l-0":"","t-100p":""},Ze=["onMouseover","onClick","onTouchstart","onTouchend"],et={"flex-left":"","gap-x-8":"",style:{margin:"0.75rem","margin-left":"2rem"}},tt={relative:"","flex-center":"","shrink-0":"","w-44":""},nt=["src"],ot={bg:"$main-bg-c",border:"2 t-0",absolute:"","z-9":"","l-0":"","t-100p":"","w-200":""},st=["onClick"],rt={"flex-center":"","gap-x-8":"",text:"15 $text-c-1"},ct=["src"],lt={"ml-4":"","font-300":""},ut={key:0,"i-carbon:checkmark":"","text-18":""},it={flex:"","items-center":"",w:"full"},at=["onKeydown"],dt=h("span",{"i-carbon:search":"","inline-block":"","text-16":""},null,-1),ft=[dt],ht=we({__name:"MainSearch",setup(t){const o=ye(),n=ke.children,e=x(""),r=x(0),a=x();function f(){r.value=n.findIndex(s=>s.key===o.settings.search)||0}D(()=>o.settings.search,()=>{f()},{immediate:!0});function c(){var v;if(!e.value.trim())return;const s=n[r.value];window.open(`${s.value.url}?${s.value.wd}=${e.value}`),M(),(v=a.value)==null||v.blur()}function g(s){return s.favicon||Se(s.url)}const d=x(!1);function w(s){r.value=s,k()}function k(){d.value=!d.value}function l(s){s.key==="#"&&!e.value.length&&(d.value=!0);const v=(e.value+s.key).match(/^#[a-z]+/);if(v){const _=v[0].replace("#",""),y=n.findIndex(S=>S.value.s===_);if(y===-1)return;s.preventDefault(),w(y),e.value="",d.value=!1}e.value==="#"&&s.key==="Backspace"&&(d.value=!1)}const i=x(!1),u=x([]),m=x(0),ce=Ce(()=>{const s=n[r.value];Ve.complete(s.key,e.value,v=>{i.value=!0,e.value.trim().length!==0&&(u.value.splice(0,u.value.length||0),u.value.push(e.value,...v.list))})},100);function le(){var s;e.value="",(s=a.value)==null||s.focus()}function K(s){if(e.value.indexOf("#")!==0){if(!e.value.trim()){M();return}m.value=0,ce()}}function ue(s){e.value=u.value[s],c()}function M(){i.value=!1,u.value.splice(0,u.value.length||0),m.value=0,u.value.push(e.value)}function T(s){s.preventDefault(),m.value=(m.value+1)%u.value.length||0,e.value=u.value[m.value]}function W(s){s.preventDefault(),m.value=(m.value-1+u.value.length)%u.value.length||0,e.value=u.value[m.value]}function ie(s){s.target!==a.value&&M()}function ae(s){m.value=s}function de(){m.value=0}function F(){K(new Event("input"))}function P(s){var v;s.ctrlKey&&s.key==="Enter"&&((v=a.value)==null||v.focus(),F())}function fe(s){m.value=s}function ve(s){m.value=0}const{iconStyle:H}=qe();return _e(()=>{window.addEventListener("keydown",P)}),be(()=>{window.removeEventListener("keydown",P)}),(s,v)=>($(),b("div",Je,[O(($(),b("div",{absolute:"","z-9":"","w-full":"","h-10em":"","t-100p":"",onMouseleave:v[0]||(v[0]=_=>de())},[h("div",Xe,[($(!0),b(Q,null,Y(p(u).slice(1),(_,y)=>($(),b("div",{key:y+1,"text-15":"","p-5":"",class:Ie(["cursor-pointer",{"bg-$site-hover-c":y+1===p(m)}]),onMouseover:S=>ae(y+1),onClick:S=>ue(y+1),onTouchstart:S=>fe(y+1),onTouchend:S=>ve()},[h("div",et,[h("div",null,N(_),1)])],42,Ze))),128))])],32)),[[G,p(i)&&p(u).length>1],[p(te),ie]]),O(($(),b("div",tt,[h("div",{hover:"op-100","h-full":"","w-full":"","flex-center":"","cursor-pointer":"",op:"80","transition-300":"",onClick:k},[h("img",{src:g(p(n)[p(r)].value),style:J(p(H)),"h-32":"","w-32":""},null,12,nt)]),O(h("div",ot,[($(!0),b(Q,null,Y(p(n),(_,y)=>($(),b("div",{key:y,hover:"bg-$site-hover-c",flex:"","cursor-pointer":"","items-center":"","justify-between":"","px-12":"","py-7":"",onClick:S=>w(y)},[h("div",rt,[h("img",{src:g(_.value),style:J(p(H)),circle:"","h-20":"","w-20":""},null,12,ct),h("div",null,N(p(Ee)(_.name)),1),h("div",lt,N(`#${_.value.s}`),1)]),p(r)===y?($(),b("div",ut)):X("",!0)],8,st))),128))],512),[[G,p(d)]])])),[[p(te),()=>d.value=!1]]),h("div",it,[O(h("input",{ref_key:"searchInputRef",ref:a,"onUpdate:modelValue":v[1]||(v[1]=_=>xe(e)?e.value=_:null),autofocus:"",text:"15 $text-c-1","h-full":"","w-full":"","bg-inherit":"","op-80":"",onKeydown:[C(c,["enter"]),l,C(R(T,["exact"]),["down"]),C(R(W,["exact"]),["up"]),C(R(T,["ctrl","exact"]),["n"]),C(R(W,["ctrl","exact"]),["p"])],onInput:K,onFocus:F},null,40,at),[[$e,p(e)]]),p(e).length>0?($(),b("div",{key:0,hover:"op-80","i-carbon:close":"","mr-8":"","cursor-pointer":"","text-20":"","op-40":"",transition:"","duration-300":"",onClick:le})):X("",!0)]),h("button",{"flex-center":"","shrink-0":"","gap-x-4":"","px-16":"",btn:"",onClick:c},ft)]))}});export{ht as _};
