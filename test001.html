<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>水墨待办事项</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Ma Shan Zheng', cursive;
      background: linear-gradient(to bottom, #f5f5f5, #e0e0e0);
    }
    .ink-wash {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid #333;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .todo-item:hover {
      background: #f0f0f0;
      transform: scale(1.02);
      transition: all 0.2s ease-in-out;
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-md ink-wash rounded-lg p-6">
    <h1 class="text-3xl text-center text-gray-800 mb-6">水墨待办</h1>
    <div class="flex mb-4">
      <input
        id="todo-input"
        type="text"
        class="flex-1 p-2 border border-gray-400 rounded-l-lg text-lg focus:outline-none"
        placeholder="请输入待办事项"
      >
      <button
        id="add-btn"
        class="bg-gray-800 text-white p-2 rounded-r-lg hover:bg-gray-700"
      >
        添加
      </button>
    </div>
    <ul id="todo-list" class="space-y-2"></ul>
  </div>

  <script>
    const input = document.getElementById('todo-input');
    const addBtn = document.getElementById('add-btn');
    const todoList = document.getElementById('todo-list');
    const restUrl = 'https://wired-mako-30204.upstash.io';
    const restToken = 'AXX8AAIjcDEwNDI3YTUzZDIyMzU0ODY4OTZkMjkzNTZhMWQzYTU3OXAxMA'; // 替换为 Upstash REST API Token

    // Load todos
    async function loadTodos() {
      try {
        const response = await fetch(`${restUrl}/lrange/todos/0/-1`, {
          method: 'GET',
          headers: {
            Authorization: `Bearer ${restToken}`,
          },
        });
        const data = await response.json();
        if (data.error) throw new Error(data.error);
        const todos = data.result || [];
        todoList.innerHTML = '';
        todos.forEach((todo, index) => {
          const li = document.createElement('li');
          li.className = 'todo-item flex justify-between items-center p-2 border-b border-gray-300';
          li.innerHTML = `
            <span>${todo}</span>
            <button class="text-red-600 hover:text-red-800" onclick="deleteTodo('${encodeURIComponent(todo)}')">删除</button>
          `;
          todoList.appendChild(li);
        });
      } catch (error) {
        console.error('加载待办事项失败:', error);
      }
    }

    // Add a todo
    async function addTodo() {
      const todo = input.value.trim();
      if (!todo) return;
      try {
        const response = await fetch(restUrl, {
          method: 'POST',
          headers: {
            Authorization: `Bearer ${restToken}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(['LPUSH', 'todos', todo]),
        });
        const data = await response.json();
        if (data.error) throw new Error(data.error);
        input.value = '';
        loadTodos();
      } catch (error) {
        console.error('添加待办事项失败:', error);
      }
    }

    // Delete a todo
    async function deleteTodo(todo) {
      try {
        const response = await fetch(restUrl, {
          method: 'POST',
          headers: {
            Authorization: `Bearer ${restToken}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(['LREM', 'todos', 1, decodeURIComponent(todo)]),
        });
        const data = await response.json();
        if (data.error) throw new Error(data.error);
        loadTodos();
      } catch (error) {
        console.error('删除待办事项失败:', error);
      }
    }

    // Event listeners
    addBtn.addEventListener('click', addTodo);
    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') addTodo();
    });

    // Initial load
    loadTodos();
  </script>
</body>
</html>
